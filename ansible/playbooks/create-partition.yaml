- name: Create partition
  hosts: all
  become: yes
  tasks:
    - name: Create primary ext4 partition
      community.general.parted:
        device: /dev/nvme0n1
        number: 1
        flags: [ lvm ]
        state: present
        fs_type: ext4

    - name: Create directory
      ansible.builtin.file:
        path: /mnt/storage
        state: directory
        mode: '755'

    - name: Mount partition
      ansible.posix.mount:
        src: /dev/nvme0n1p1
        path: /mnt/storage
        opts: defaults
        state: present
        fstype: ext4
        boot: true
