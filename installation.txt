sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 04EE7237B7D453EC
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 648ACFD622F3D138
apt install python3 python3-venv -y
cd ~
VENV_DIR=kubespray-venv
KUBESPRAY_DIR=kubespray
ANSIBLE_VERSION=2.11
KUBESPRAY_VERSION=2.21

git clone https://github.com/kubernetes-incubator/kubespray.git
cd $KUBESPRAY_DIR
git checkout release-$KUBESPRAY_VERSION

python3 -m venv $VENV_DIR
source $VENV_DIR/bin/activate
python3 -m pip install --upgrade pip
pip install -U -r requirements-$ANSIBLE_VERSION.txt

declare -r CLUSTER_DIR='mycluster'
cp -rfp inventory/local inventory/$CLUSTER_DIR

declare -a IPS=(192.168.2.144)
CONFIG_FILE=inventory/mycluster/hosts.yml python3 contrib/inventory_builder/inventory.py ${IPS[@]}

ansible-playbook \
-i inventory/$CLUSTER_DIR/hosts.yml \
-c=local \
-b \
--verbose \
reset.yml

ansible-playbook \
-i inventory/$CLUSTER_DIR/hosts.yml \
-c=local \
-b \
cluster.yml

# group_vars/k8s_cluster/k8s-cluster.yml 
# kubeconfig_localhost: true

sudo cp -r /root/.kube $HOME
sudo chown -R $USER $HOME/.kube